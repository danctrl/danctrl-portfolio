---
import Astronaut from "../components/Astronaut.astro";

interface Props {
    title?: string;
    description?: string;
}

const {
    title = "Daniel Guntermann – DevOps | AI | Cybersecurity",
    description = "Portfolio of Daniel Guntermann – Junior DevOps Engineer, AI enthusiast, and cybersecurity advocate based in Berlin.",
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, "https://danctrl.dev");
const ogImage = new URL("/og-image.png", "https://danctrl.dev");
---

<!doctype html>
<html lang="en" class="dark scroll-smooth">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="icon" href="/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
        <meta name="description" content={description} />
        <meta name="generator" content={Astro.generator} />
        <link rel="canonical" href={canonicalURL.href} />
        <!-- Open Graph -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={canonicalURL.href} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={ogImage.href} />
        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={ogImage.href} />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700;800&family=Poppins:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <title>{title}</title>
        <script
            src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit"
            async
            defer></script>
        <!-- Prevent flash of wrong theme -->
        <script is:inline>
            (function () {
                const stored = localStorage.getItem("theme");
                if (stored === "light") {
                    document.documentElement.classList.remove("dark");
                } else if (stored === "dark") {
                    document.documentElement.classList.add("dark");
                } else if (
                    !window.matchMedia("(prefers-color-scheme: dark)").matches
                ) {
                    document.documentElement.classList.remove("dark");
                }
            })();
        </script>
    </head>
    <body
        class="dot-grid isolate bg-[#f7f7f5] text-[#1a1a1a] font-sans antialiased dark:bg-[#0a0a0a] dark:text-gray-50"
    >
        <a
            href="#hero"
            class="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-60 focus:rounded-lg focus:bg-emerald-600 focus:px-4 focus:py-2 focus:text-sm focus:font-semibold focus:text-white"
            >Skip to content</a
        >
        <nav
            class="glass fixed top-0 left-0 right-0 z-50 border-b dark:border-b"
            aria-label="Main navigation"
        >
            <div
                class="mx-auto flex max-w-5xl items-center justify-between px-6 py-4"
            >
                <!-- Logo -->
                <a
                    href="/"
                    class="font-mono text-lg font-extrabold tracking-tight text-[#1a1a1a] dark:text-white"
                >
                    danctrl
                </a>

                <!-- Center nav links -->
                <ul
                    class="hidden items-center gap-8 font-mono text-sm font-medium text-gray-500 md:flex dark:text-gray-400"
                >
                    <li>
                        <a href="#about" class="nav-link" data-section="about"
                            >About</a
                        >
                    </li>
                    <li>
                        <a
                            href="#projects"
                            class="nav-link"
                            data-section="projects">Projects</a
                        >
                    </li>
                    <li>
                        <a href="#skills" class="nav-link" data-section="skills"
                            >Skills</a
                        >
                    </li>
                    <li>
                        <a
                            href="#contact"
                            class="nav-link"
                            data-section="contact">Contact</a
                        >
                    </li>
                </ul>

                <!-- Right side: CV button + theme toggle + mobile menu -->
                <div class="flex items-center gap-3">
                    <div
                        class="btn-cv-wrap hidden w-35px items-center justify-center sm:flex"
                    >
                        <a
                            href="/cv.pdf"
                            class="btn-cv group relative inline-flex h-10 w-35 items-center justify-center overflow-hidden rounded-lg text-sm"
                        >
                            <span
                                class="btn-cv-text whitespace-nowrap font-semibold text-white"
                                >Download CV</span
                            >
                            <svg
                                class="btn-cv-icon absolute h-5 w-5 text-white"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2m-4-4l-4 4m0 0l-4-4m4 4V4"
                                ></path>
                            </svg>
                        </a>
                    </div>

                    <!-- Theme toggle -->
                    <button
                        id="theme-toggle"
                        class="relative h-9 w-9 overflow-hidden rounded-lg text-gray-400 transition-all hover:bg-emerald-600/10 hover:text-emerald-600 dark:text-gray-500 dark:hover:bg-emerald-400/10 dark:hover:text-emerald-400"
                        aria-label="Toggle theme"
                    >
                        <!-- Sun icon -->
                        <svg
                            id="icon-sun"
                            class="theme-icon absolute inset-0 m-auto h-5 w-5"
                            fill="currentColor"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                            ></path>
                        </svg>
                        <!-- Moon icon -->
                        <svg
                            id="icon-moon"
                            class="theme-icon absolute inset-0 m-auto h-5 w-5"
                            fill="currentColor"
                            stroke="none"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                            ></path>
                        </svg>
                    </button>

                    <!-- Mobile menu button -->
                    <button
                        id="mobile-menu-btn"
                        class="text-gray-500 transition-colors hover:text-[#1a1a1a] md:hidden dark:text-gray-400 dark:hover:text-white"
                        aria-label="Toggle menu"
                    >
                        <svg
                            class="h-6 w-6"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile menu -->
            <div
                id="mobile-menu"
                class="hidden border-t border-gray-200 md:hidden dark:border-white/5"
            >
                <ul
                    class="flex flex-col gap-4 px-6 py-4 text-sm text-gray-500 dark:text-gray-400"
                >
                    <li>
                        <a
                            href="#about"
                            class="transition-colors hover:text-[#1a1a1a] dark:hover:text-white"
                            >About</a
                        >
                    </li>
                    <li>
                        <a
                            href="#projects"
                            class="transition-colors hover:text-[#1a1a1a] dark:hover:text-white"
                            >Projects</a
                        >
                    </li>
                    <li>
                        <a
                            href="#skills"
                            class="transition-colors hover:text-[#1a1a1a] dark:hover:text-white"
                            >Skills</a
                        >
                    </li>
                    <li>
                        <a
                            href="#contact"
                            class="transition-colors hover:text-[#1a1a1a] dark:hover:text-white"
                            >Contact</a
                        >
                    </li>
                    <li>
                        <a
                            href="/cv.pdf"
                            class="text-emerald-600 transition-colors hover:text-emerald-600 dark:text-emerald-400"
                        >
                            Download CV
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Cursor glow (desktop only) -->
        <Astronaut />
        <main class="relative z-10">
            <div
                id="cursor-glow"
                class="cursor-glow hidden md:block"
                aria-hidden="true"
            >
            </div>
            <slot />
        </main>

        <footer
            class="glass relative z-10 text-sm text-gray-500 dark:text-gray-500"
        >
            <div class="mx-auto max-w-5xl px-6 py-8">
                <div
                    class="flex flex-col items-center justify-between gap-6 sm:flex-row"
                >
                    <div>
                        <p
                            class="font-mono text-sm font-semibold text-[#1a1a1a] dark:text-white"
                        >
                            danctrl
                        </p>
                        <p
                            class="mt-1 text-xs text-gray-400 dark:text-gray-500"
                        >
                            &copy; {new Date().getFullYear()} &middot; Made with ❤️
                            and <a
                                href="https://astro.build"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="text-gray-400 no-underline transition-colors hover:text-emerald-600 hover:underline dark:text-gray-500 dark:hover:text-emerald-400"
                                >rocket fuel</a
                            > &middot; Berlin
                        </p>
                    </div>
                    <div class="flex items-center gap-3">
                        <a
                            href="https://github.com/danctrl"
                            target="_blank"
                            rel="noopener noreferrer"
                            aria-label="GitHub"
                            class="rounded-lg p-2 text-gray-400 transition-all hover:bg-emerald-600/10 hover:text-emerald-600 dark:text-gray-500 dark:hover:bg-emerald-400/10 dark:hover:text-emerald-400"
                        >
                            <svg
                                class="h-5 w-5"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"
                                ></path></svg
                            >
                        </a>
                        <a
                            href="https://linkedin.com/in/danielguntermann"
                            target="_blank"
                            rel="noopener noreferrer"
                            aria-label="LinkedIn"
                            class="rounded-lg p-2 text-gray-400 transition-all hover:bg-emerald-600/10 hover:text-emerald-600 dark:text-gray-500 dark:hover:bg-emerald-400/10 dark:hover:text-emerald-400"
                        >
                            <svg
                                class="h-5 w-5"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
                                ></path></svg
                            >
                        </a>
                        <a
                            href="https://t.me/danielguntagram"
                            target="_blank"
                            rel="noopener noreferrer"
                            aria-label="Telegram"
                            class="rounded-lg p-2 text-gray-400 transition-all hover:bg-emerald-600/10 hover:text-emerald-600 dark:text-gray-500 dark:hover:bg-emerald-400/10 dark:hover:text-emerald-400"
                        >
                            <svg
                                class="h-5 w-5"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                                ><path
                                    d="M11.944 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0a12 12 0 00-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 01.171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"
                                ></path></svg
                            >
                        </a>
                    </div>
                </div>
            </div>
        </footer>

        <script>
            // Active nav link on scroll – clear all when hero is visible
            const navLinks = document.querySelectorAll(".nav-link");
            const sections = document.querySelectorAll("section[id]");
            const navObserver = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (
                            entry.isIntersecting &&
                            entry.target.id === "hero"
                        ) {
                            navLinks.forEach((l) =>
                                l.classList.remove("active"),
                            );
                            return;
                        }
                        const link = document.querySelector(
                            `.nav-link[data-section="${entry.target.id}"]`,
                        );
                        if (!link) return;
                        if (entry.isIntersecting) {
                            navLinks.forEach((l) =>
                                l.classList.remove("active"),
                            );
                            link.classList.add("active");
                        }
                    });
                },
                { rootMargin: "-40% 0px -60% 0px" },
            );
            sections.forEach((section) => navObserver.observe(section));

            // Mobile menu toggle
            const btn = document.getElementById("mobile-menu-btn");
            const menu = document.getElementById("mobile-menu");
            btn?.addEventListener("click", () =>
                menu?.classList.toggle("hidden"),
            );
            menu?.querySelectorAll("a").forEach((link) =>
                link.addEventListener("click", () =>
                    menu?.classList.add("hidden"),
                ),
            );

            // Theme toggle with rise/set animation
            const toggle = document.getElementById("theme-toggle");
            const iconSun = document.getElementById("icon-sun");
            const iconMoon = document.getElementById("icon-moon");

            function setIconState(isDark: boolean, animate = false) {
                if (!iconSun || !iconMoon) return;
                if (animate) {
                    // Current icon drops down
                    const leaving = isDark ? iconMoon : iconSun;
                    const entering = isDark ? iconSun : iconMoon;
                    leaving.style.transition =
                        "transform 0.3s ease-in, opacity 0.3s ease-in";
                    leaving.style.transform = "translateY(100%)";
                    leaving.style.opacity = "0";
                    // New icon rises from below
                    entering.style.transition = "none";
                    entering.style.transform = "translateY(-100%)";
                    entering.style.opacity = "0";
                    requestAnimationFrame(() => {
                        entering.style.transition =
                            "transform 0.3s ease-out 0.15s, opacity 0.3s ease-out 0.15s";
                        entering.style.transform = "translateY(0)";
                        entering.style.opacity = "1";
                    });
                } else {
                    // Initial state, no animation
                    const active = isDark ? iconSun : iconMoon;
                    const inactive = isDark ? iconMoon : iconSun;
                    active.style.transform = "translateY(0)";
                    active.style.opacity = "1";
                    inactive.style.transform = "translateY(100%)";
                    inactive.style.opacity = "0";
                }
            }

            // Set initial state
            setIconState(document.documentElement.classList.contains("dark"));

            toggle?.addEventListener("click", () => {
                const html = document.documentElement;
                html.classList.add("theme-transition");
                html.classList.toggle("dark");
                const isDark = html.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
                setIconState(isDark, true);
                window.dispatchEvent(new CustomEvent("theme-change", { detail: { isDark } }));
                setTimeout(
                    () => html.classList.remove("theme-transition"),
                    300,
                );
            });

            // CV download click animation
            const cvWrap = document.querySelector(".btn-cv-wrap");
            const cvLink = cvWrap?.querySelector<HTMLAnchorElement>(".btn-cv");
            cvLink?.addEventListener("click", (e) => {
                e.preventDefault();
                cvWrap!.classList.add("downloading");
                const href = cvLink.href;
                setTimeout(() => {
                    cvWrap!.classList.remove("downloading");
                    window.open(href, "_blank");
                }, 600);
            });

            // Scroll fade-in with Intersection Observer
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add("is-visible");
                            observer.unobserve(entry.target);
                        }
                    });
                },
                { threshold: 0.1 },
            );
            document
                .querySelectorAll(".fade-in, .fade-in-left")
                .forEach((el) => observer.observe(el));

            // Cursor glow (desktop only, no touch)
            const glow = document.getElementById("cursor-glow");
            if (glow && !("ontouchstart" in window)) {
                let mouseX = 0;
                let mouseY = 0;
                let glowX = 0;
                let glowY = 0;

                document.addEventListener("mousemove", (e) => {
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                    const target = e.target as HTMLElement;
                    const overCard = target?.closest(".section-card, .avatar-wrap");
                    if (overCard) {
                        glow.classList.remove("is-active");
                    } else if (!glow.classList.contains("is-active")) {
                        glow.classList.add("is-active");
                    }
                });

                document.addEventListener("mouseleave", () => {
                    glow.classList.remove("is-active");
                });

                function animateGlow() {
                    glowX += (mouseX - glowX) * 0.15;
                    glowY += (mouseY - glowY) * 0.15;
                    if (glow) {
                        glow.style.left = glowX + "px";
                        glow.style.top = glowY + "px";
                    }
                    requestAnimationFrame(animateGlow);
                }
                animateGlow();
            }
        </script>

        <!-- Cloudflare Web Analytics -->
        <script
            defer
            src="https://static.cloudflareinsights.com/beacon.min.js"
            data-cf-beacon='{"token": "23cc8b3ebf844cd291ba8a5e4196b333"}'
        ></script>
        <!-- End Cloudflare Web Analytics -->
    </body>
</html>
